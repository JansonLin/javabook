## 3.1 JVM 内存申请

JAVA内存的管理主要是由JVM（JAVA 虚拟机）完成的，JVM负责和操作系统打交道，获取内存或释放内存。一般分三种情况：程序运行前；程序运行时；系统内存溢出。

* 程序运行前

不想C/C++语言那样可以直接向操作系统请求内存，Java并不支持这种操作。这样做的一个重要优点是保证了程序的平台无关性，同时确保安全性。既然Java程序不负责创建内存空间，那由谁创建呢？聪明的读者可能已经想到，是由JVM完成。当程序准备执行时，由JVM向操作系统请求一定的内存空间，称为初始内存空间。程序执行过程中所需的内存都由JVM从这片内存空间中划分的。如图3-1所示

![](/assets/3-1.png)

* 程序运行时

Java程序一直向JVM申请内存，当程序所需内存空间超出初始内存空间时，JVM会再次向操作系统申请更多的内存供程序使用。如图 3-2。

![](/assets/3-2.png)

* 系统内存溢出

程序需要更多地内存空间，继续申请内存，当JVM已申请的内存达到了规定的最大内存空间，但程序还需要更多的内存，这时会出现内存溢出的错误。如图 3-3。

![](/assets/3-3.png)

可以看出，Java程序所使用的内存是由Java虚拟机进行管理、分配的。 Java 虚拟机规定了Java程序的初始内存空间和最大内存空间，开发者只需 要关心Java虚拟机是如何管理内存空间的，而不用关心某一种操作系统是如何管理内存的。如果需要修改默认参数，用户可以再系统环境变量中增 加新的环境变量：JAVA\_OPTS，具体配置见下面描述。Java给我们提供了Runtime类，通过这个类可以得到JVM的内存信息。 如下表3-1所示。

| 方法名称参数 | 参数 | 作用 | 返回值 |
| :---: | :---: | :---: | :---: |
| getRuntime | 无 | 获取Runtime对象 | Runtime 对象 |
| totalMoney | 无 | 获取JVM分配给程序的内存数量 | long: 内存数量 |
| freeMoney | 无 | 获取当前可用的内存数量 | long: 内存数量 |
| maxMoney | 无 | 获取JVM能申请到的最大内存 | long: 内存数量 |



